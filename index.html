<!--
  PayTrax Payroll Management
  Copyright (c) 2025 greenwh

  Developed by greenwh with substantial assistance from AI coding tools (Claude, ChatGPT, Gemini).
  This file is original work based on documentation and prompts by greenwh.
  Licensed under the MIT License.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayTrax</title>
    
    <!-- PWA & Mobile Experience Enhancements -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="apple-mobile-web-app-title" content="PayTrax">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PayTrax</h1>
            <p>Track. Calculate. Comply.</p>
        </div>

        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">Dashboard</button>
            <button class="nav-tab" data-tab="settings">Settings</button>
            <button class="nav-tab" data-tab="payroll">Pay Periods</button>
            <button class="nav-tab" data-tab="paystub">Pay Stub</button>
            <button class="nav-tab" data-tab="reports">Reports</button>
            <button class="nav-tab" data-tab="banking">Banking</button>
            <!-- NEW: Added Documentation Link -->
            <a href="./docs/" target="_blank" rel="noopener noreferrer" class="nav-tab">Docs</a>
        </nav>

        <div id="dashboard" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <span class="status-indicator status-active"></span>
                    Payroll Dashboard
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <strong>Quick Start:</strong> Add employees in Settings, then select an employee and pay period here to enter hours.
                    </div>
                    
                    <div class="form-grid">
                         <div class="form-group">
                            <label class="form-label">Select Employee</label>
                            <select id="currentEmployee" class="form-input">
                                <option value="">Select Employee...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Current Pay Period</label>
                            <select id="currentPeriod" class="form-input">
                                <option value="">Select Pay Period...</option>
                            </select>
                        </div>
                    </div>

                     <div class="card" style="margin-top: 20px;">
                        <div class="card-header" style="background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);">Enter Hours for Period</div>
                        <div class="card-body">
                            <div class="hour-entry-grid">
                                <div class="form-group">
                                    <label class="form-label">Regular</label>
                                    <input type="number" id="regularHours" class="form-input hour-input" placeholder="40" step="0.25">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Overtime</label>
                                    <input type="number" id="overtimeHours" class="form-input hour-input" placeholder="5" step="0.25">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Paid Time Off</label>
                                    <input type="number" id="ptoHours" class="form-input hour-input" placeholder="8" step="0.25">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Holiday</label>
                                    <input type="number" id="holidayHours" class="form-input hour-input" placeholder="8" step="0.25">
                                </div>
                            </div>
                        </div>
                    </div>


                    <div id="periodDetails" style="display: none;" class="card">
                        <div class="card-body">
                            <h4>Pay Period Details</h4>
                            <div class="form-grid">
                                <div><strong>Period:</strong> <span id="periodNumber"></span></div>
                                <div><strong>Start Date:</strong> <span id="startDate"></span></div>
                                <div><strong>End Date:</strong> <span id="endDate"></span></div>
                                <div><strong>Pay Date:</strong> <span id="payDate"></span></div>
                                <div><strong>PTO Balance:</strong> <span id="ptoBalanceDisplay" style="font-weight: bold; color: #0056b3;">0.00</span> hours</div>
                            </div>
                            
                            <div class="form-grid">
                                <div><strong>Gross Pay:</strong> $<span id="grossPay">0.00</span></div>
                                <div><strong>Total Employee Taxes:</strong> $<span id="totalTaxes">0.00</span></div>
                                <div><strong>Net Pay:</strong> $<span id="netPay">0.00</span></div>
                                <div><strong>Employer Taxes:</strong> $<span id="employerTaxes">0.00</span></div>
                                <div><strong>Total Payroll Cost:</strong> $<span id="totalPayrollCost">0.00</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">Bank Funds Required</div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="summary-box" style="border-color: #000;">
                                    <h5>Remaining This Month</h5>
                                    <p><strong>$<span id="thisMonthRequired">0.00</span></strong></p>
                                    <small>Funds needed for remaining pay periods this month</small>
                                </div>
                                <div class="summary-box" style="border-color: #000;">
                                    <h5>Next Month Projection</h5>
                                    <p><strong>$<span id="nextMonthRequired">0.00</span></strong></p>
                                    <small>Projected funds needed for next month's payroll</small>
                                </div>
                            </div>
                            <p><em>Based on <span id="projectedHours">0.0</span> hours per period average for all employees</em></p>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 25px;">
                        <button class="btn btn-primary" id="generatePayStubBtn">Generate Pay Stub</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="card">
                <div class="card-header">Company Settings</div>
                <div class="card-body" id="companySettingsForm">
                     <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Company Name</label>
                            <input type="text" id="companyName" class="form-input" placeholder="Your Company Name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tax Year</label>
                            <input type="number" id="taxYear" class="form-input" placeholder="2025" min="2020" max="2030">
                        </div>
                         <div class="form-group">
                            <label class="form-label">Tax Year First Pay Period Start date</label>
                            <input type="date" id="firstPayPeriodStartDate" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pay Frequency</label>
                            <select id="payFrequency" class="form-input">
                                <option value="weekly">Weekly (52 periods)</option>
                                <option value="bi-weekly">Bi-Weekly (26 periods)</option>
                                <option value="semi-monthly">Semi-Monthly (24 periods)</option>
                                <option value="monthly">Monthly (12 periods)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Days Until Payday <small>(after period end)</small></label>
                            <input type="number" id="daysUntilPayday" class="form-input" placeholder="e.g., 5" value="5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Company Address</label>
                            <input type="text" id="companyAddress" class="form-input" placeholder="123 Main St, City, ST 12345">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Company Phone</label>
                            <input type="tel" id="companyPhone" class="form-input" placeholder="(555) 555-5555">
                        </div>
                    </div>
                </div>
            </div>
            
             <div class="card">
                <div class="card-header">Tax Settings</div>
                <div class="card-body" id="taxSettingsForm">
                    <h4>Global Tax Rates</h4>
                    <div class="form-grid">
                         <div class="form-group">
                            <label class="form-label">Social Security Rate (%)</label>
                            <input type="number" id="socialSecurity" class="form-input" value="6.2" step="0.1" min="0" max="10">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Medicare Rate (%)</label>
                            <input type="number" id="medicare" class="form-input" value="1.45" step="0.1" min="0" max="5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">SUTA Rate (%) - Employer</label>
                            <input type="number" id="sutaRate" class="form-input" placeholder="2.7" step="0.1" min="0" max="10">
                        </div>
                        <div class="form-group">
                            <label class="form-label">FUTA Rate (%) - Employer</label>
                            <input type="number" id="futaRate" class="form-input" value="0.6" step="0.1" min="0" max="2">
                        </div>
                    </div>
                     <hr style="margin: 20px 0;">
                    <h4>Tax Wage Limits & Thresholds</h4>
                    <div class="form-grid">
                         <div class="form-group">
                            <label class="form-label">Social Security Wage Base ($)</label>
                            <input type="number" id="ssWageBase" class="form-input" value="168600" step="1" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">FUTA Wage Base ($)</label>
                            <input type="number" id="futaWageBase" class="form-input" value="7000" step="1" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Additional Medicare Threshold ($)</label>
                            <input type="number" id="additionalMedicareThreshold" class="form-input" value="200000" step="1" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Additional Medicare Rate (%)</label>
                            <input type="number" id="additionalMedicareRate" class="form-input" value="0.9" step="0.1" min="0" max="5">
                        </div>
                    </div>
                     <hr style="margin: 20px 0;">
                    <h4>Tax Payment Frequencies</h4>
                     <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Federal Payroll (941)</label>
                            <select id="federalTaxFrequency" class="form-input">
                                <option value="weekly">Weekly</option>
                                <option value="bi-weekly">Bi-Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label class="form-label">FUTA (940)</label>
                            <select id="futaTaxFrequency" class="form-input">
                                <option value="weekly">Weekly</option>
                                <option value="bi-weekly">Bi-Weekly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="annual">Annual</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label class="form-label">SUTA</label>
                            <select id="sutaTaxFrequency" class="form-input">
                                <option value="weekly">Weekly</option>
                                <option value="bi-weekly">Bi-Weekly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="annual">Annual</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">State Income Tax</label>
                            <select id="stateTaxFrequency" class="form-input">
                                <option value="weekly">Weekly</option>
                                <option value="bi-weekly">Bi-Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="annual">Annual</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label class="form-label">Local Tax</label>
                            <select id="localTaxFrequency" class="form-input">
                                <option value="weekly">Weekly</option>
                                <option value="bi-weekly">Bi-Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="annual">Annual</option>
                            </select>
                        </div>
                    </div>
                    <hr style="margin: 20px 0;">
                    <h4>Bank Register Settings</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="autoSubtraction" checked>
                                Automatic bank subtractions at payroll processing
                            </label>
                            <small style="display: block; color: #6c757d; margin-top: 5px;">
                                When enabled, payroll costs are automatically deducted from the bank register balance.
                                Disable if you pay employees from a separate account not tracked here.
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Employee Management</div>
                <div class="card-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Employee List</label>
                            <select id="employeeList" class="form-input">
                                <option value="">Select Employee to Edit...</option>
                            </select>
                        </div>
                    </div>
                    <hr style="margin: 20px 0;">
                    <h4 id="employeeFormTitle">Add New Employee</h4>
                     <form id="employeeForm">
                        <input type="hidden" id="employeeId">
                        
                        <h5>General & Pay</h5>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Employee ID #</label>
                                <input type="text" id="idNumber" class="form-input" placeholder="e.g., 001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Employee Name</label>
                                <input type="text" id="employeeName" class="form-input" placeholder="Full Name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Address</label>
                                <input type="text" id="employeeAddress" class="form-input" placeholder="123 Oak St, City, ST 12345">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Regular Hourly Rate ($)</label>
                                <input type="number" id="hourlyRate" class="form-input" placeholder="15.00" step="0.01" min="0" required>
                            </div>
                             <div class="form-group">
                                <label class="form-label">Overtime Rate Multiplier</label>
                                <input type="number" id="overtimeRate" class="form-input" value="1.5" step="0.1" min="1">
                            </div>
                             <div class="form-group">
                                <label class="form-label">Holiday Rate Multiplier</label>
                                <input type="number" id="holidayRate" class="form-input" value="2.0" step="0.1" min="1">
                            </div>
                        </div>

                        <h5>Tax Withholding</h5>
                         <div class="form-grid">
                             <div class="form-group">
                                <label class="form-label">Federal Tax Rate (%)</label>
                                <input type="number" id="federalTax" class="form-input" placeholder="12.0" step="0.1" min="0" max="50" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">State Tax Rate (%)</label>
                                <input type="number" id="stateTax" class="form-input" placeholder="5.0" step="0.1" min="0" max="15" value="0">
                            </div>
                             <div class="form-group">
                                <label class="form-label">Local Tax Rate (%)</label>
                                <input type="number" id="localTax" class="form-input" placeholder="1.0" step="0.1" min="0" max="10" value="0">
                            </div>
                        </div>

                        <h5>Leave / Paid Time Off (PTO)</h5>
                        <div class="form-grid">
                             <div class="form-group">
                                <label class="form-label">Annual PTO Accrual Rate (hours)</label>
                                <input type="number" id="ptoAccrualRate" class="form-input" placeholder="e.g., 80" step="1" min="0" value="0">
                            </div>
                             <div class="form-group">
                                <label class="form-label">Current PTO Balance (hours)</label>
                                <input type="number" id="ptoBalance" class="form-input" placeholder="e.g., 25.5" step="0.01" min="0" value="0">
                            </div>
                        </div>

                        <h5>Employee Deductions</h5>
                        <div id="deductionsSection" style="display:none;">
                            <div style="overflow-x: auto; margin-bottom: 15px;">
                                <table class="report-table" id="deductionsTable">
                                    <thead>
                                        <tr>
                                            <th>Deduction Name</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Effective Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deductionsTableBody">
                                    </tbody>
                                </table>
                            </div>

                            <div class="card" style="background: #f8f9fa;">
                                <div class="card-body">
                                    <h6>Add Deduction</h6>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">Deduction Name</label>
                                            <input type="text" id="deductionName" class="form-input" placeholder="e.g., 401k, Health Insurance">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Type</label>
                                            <select id="deductionType" class="form-input">
                                                <option value="fixed">Fixed Amount ($)</option>
                                                <option value="percent">Percentage of Gross (%)</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Amount</label>
                                            <input type="number" id="deductionAmount" class="form-input" placeholder="100.00" step="0.01" min="0.01">
                                        </div>
                                    </div>
                                    <div style="text-align: center; margin-top: 10px;">
                                        <button type="button" class="btn btn-success btn-sm" id="addDeductionBtn">Add Deduction</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="noEmployeeDeductionMsg" style="text-align: center; color: #6c757d; font-style: italic; margin: 15px 0;">
                            Save employee first to manage deductions
                        </div>

                         <div style="text-align: center;">
                            <button type="submit" class="btn btn-primary">Save Employee</button>
                            <button type="button" class="btn btn-secondary" id="newEmployeeBtn">New Employee</button>
                             <button type="button" class="btn btn-danger" id="deleteEmployeeBtn" style="display:none;">Delete Employee</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Data Management</div>
                <div class="card-body" style="text-align: center;">
                    <p>Save a backup of your data to a file or import data from a backup file.</p>
                    <div style="margin-top: 20px; display: flex; justify-content: center; gap: 15px;">
                        <button class="btn btn-success" id="importDataBtn">Import Data</button>
                        <button class="btn btn-warning" id="exportDataBtn">Export Data</button>
                    </div>
                    <div class="alert alert-info" style="margin-top: 20px; text-align: left;">
                        <strong>Note:</strong> Importing data will overwrite all current application data. It's recommended to export a backup first. The application will automatically reload after a successful import.
                    </div>
                </div>
            </div>
        </div>

        <div id="payroll" class="tab-content">
            <div class="card">
                <div class="card-header">Pay Period Data</div>
                <div class="card-body">
                    <p>Showing data for employee: <strong id="payrollTabEmployeeName">None Selected</strong></p>
                    <div style="overflow-x: auto;">
                        <table class="report-table" id="payPeriodsTable">
                            <thead>
                                <tr>
                                    <th>Period #</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Pay Date</th>
                                    <th>Total Hours</th>
                                    <th>Gross Pay</th>
                                    <th>Fed Tax</th>
                                    <th>State Tax</th>
                                    <th>Local Tax</th>
                                    <th>FICA</th>
                                    <th>Medicare</th>
                                    <th>Net Pay</th>
                                </tr>
                            </thead>
                            <tbody id="payPeriodsBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="paystub" class="tab-content">
            <div class="card">
                <div class="card-header">Generated Pay Stub</div>
                <div class="card-body">
                    <div id="paystubContent" class="paystub">
                        <div class="paystub-header">
                            <div class="company-info">
                                <div class="company-name" id="paystubCompanyName">Your Company LLC</div>
                                <div id="paystubCompanyAddress"></div>
                            </div>
                            
                            <div class="non-negotiable">NON-NEGOTIABLE</div>
                            
                            <div class="pay-info">
                                <div class="employee-info">
                                    <div><strong>PAY TO THE ORDER OF:</strong> <span id="paystubEmployeeName"></span></div>
                                    <div id="paystubEmployeeAddress"></div>
                                    <div><strong>EMPLOYEE ID #:</strong> <span id="paystubEmployeeId"></span></div>
                                </div>
                                
                                <div class="period-info">
                                    <div><strong>Period Start:</strong> <span id="paystubStartDate"></span></div>
                                    <div><strong>Period End:</strong> <span id="paystubEndDate"></span></div>
                                    <div><strong>Check Date:</strong> <span id="paystubPayDate"></span></div>
                                </div>
                            </div>
                        </div>

                        <table class="paystub-table">
                            <thead>
                                <tr>
                                    <th>Earnings Type</th>
                                    <th>Rate</th>
                                    <th>Hours</th>
                                    <th>Current</th>
                                    <th>YTD</th>
                                </tr>
                            </thead>
                            <tbody id="paystubEarningsBody">
                                </tbody>
                            <tfoot>
                                <tr style="font-weight: bold;">
                                    <td>TOTAL EARNINGS</td>
                                    <td></td>
                                    <td class="text-right" id="paystubTotalHours"></td>
                                    <td class="text-right">$<span id="paystubTotalCurrent"></span></td>
                                    <td class="text-right">$<span id="paystubTotalYTD"></span></td>
                                </tr>
                            </tfoot>
                        </table>

                        <div class="totals-section">
                            <div>
                                <div><strong>TAXES</strong></div>
                                <table class="paystub-table">
                                    <thead>
                                        <tr>
                                            <th>Taxes Type</th>
                                            <th>Current</th>
                                            <th>YTD</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paystubTaxesBody">
                                    </tbody>
                                </table>

                                <div id="paystubDeductionsSection" style="margin-top: 20px; display: none;">
                                    <div><strong>DEDUCTIONS</strong></div>
                                    <table class="paystub-table">
                                        <thead>
                                            <tr>
                                                <th>Deduction Name</th>
                                                <th>Current</th>
                                            </tr>
                                        </thead>
                                        <tbody id="paystubDeductionsBody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div>
                                <div class="summary-box">
                                    <div><strong>TOTAL EARNINGS:</strong> $<span id="paystubSummaryGross"></span></div>
                                    <div><strong>TOTAL TAXES:</strong> $<span id="paystubSummaryTaxes"></span></div>
                                    <div><strong>TOTAL DEDUCTIONS:</strong> $<span id="paystubSummaryDeductions">0.00</span></div>
                                </div>

                                <div class="summary-box">
                                    <div><strong>YTD TOTALS</strong></div>
                                    <div>Earnings: $<span id="paystubYTDEarnings"></span></div>
                                    <div>Taxes: $<span id="paystubYTDTaxes"></span></div>
                                    <div>Deductions: $<span id="paystubYTDDeductions">0.00</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="net-pay">
                            NET PAY: $<span id="paystubNetPay"></span>
                        </div>
                        
                        <div class="pto-summary">
                            <h4>Paid Time Off Summary</h4>
                            <div style="display: flex; justify-content: space-around; text-align: center;">
                                <div><strong>Beginning</strong><br><span id="ptoBegin">0.00</span></div>
                                <div><strong>Earned</strong><br><span id="ptoEarned">0.00</span></div>
                                <div><strong>Used</strong><br><span id="ptoUsed">0.00</span></div>
                                <div><strong>Ending Balance</strong><br><span id="ptoEnd">0.00</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button class="btn btn-secondary" id="printPayStubBtn">Print Pay Stub</button>
                        <button class="btn btn-success" id="exportPayStubPDFBtn">Export to PDF</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="reports" class="tab-content">
            <div class="card">
                <div class="card-header">Reports & Compliance</div>
                <div class="card-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Report Type</label>
                            <select id="reportType" class="form-input">
                                <option value="" selected disabled>Select Report Type...</option>
                                <option value="taxdeposit">Tax Deposit Report</option>
                                <option value="annual">Annual W-2 Data</option>
                                <option value="941">IRS Form 941 Data (Quarterly)</option>
                                <option value="940">IRS Form 940 Data (Annual)</option>
                                <option value="daterange-employee">Custom: Employee Wages</option>
                                <option value="daterange-employer">Custom: Employer Expenses</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="reportEmployeeGroup" style="display: none;">
                            <label class="form-label">Select Employee</label>
                            <select id="reportEmployee" class="form-input">
                                <option value="all">All Employees</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="reportPeriodGroup">
                            </div>
                        
                        <div class="form-group" id="reportDateRangeGroup" style="display: none;">
                            <label class="form-label">Start Date</label>
                            <input type="date" id="reportStartDate" class="form-input">
                             <label class="form-label" style="margin-top:10px;">End Date</label>
                            <input type="date" id="reportEndDateRange" class="form-input">
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 25px;">
                        <button class="btn btn-primary" id="generateReportBtn">Generate Report</button>
                    </div>
                    
                    <div id="reportOutput">
                        <div class="alert alert-info">
                            Select a report type and period, then click "Generate Report" to view tax calculations and compliance data.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="banking" class="tab-content">
            <div class="card">
                <div class="card-header">Bank Register</div>
                <div class="card-body">
                    <div class="card" style="margin-bottom: 30px;">
                        <div class="card-body" style="text-align: center;">
                            <h3 style="margin-bottom: 10px;">Current Balance</h3>
                            <h2 id="currentBalance" style="font-size: 2.5em; color: #28a745;">$0.00</h2>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" style="background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);">Add New Transaction</div>
                        <div class="card-body">
                            <form id="transactionForm">
                                <div class="banking-form-grid">
                                    <div class="form-group">
                                        <label for="transDate" class="form-label">Date</label>
                                        <input type="date" id="transDate" class="form-input banking-date-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="transDesc" class="form-label">Description</label>
                                        <input type="text" id="transDesc" class="form-input" placeholder="e.g., Office Supplies" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="transType" class="form-label">Type</label>
                                        <select id="transType" class="form-input">
                                            <option value="debit">Debit / Withdrawal</option>
                                            <option value="credit">Credit / Deposit</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="transAmount" class="form-label">Amount</label>
                                        <input type="number" id="transAmount" class="form-input banking-amount-input" placeholder="50.00" step="0.01" min="0" required>
                                    </div>
                                </div>
                                <div style="text-align: center;">
                                    <button type="submit" class="btn btn-primary">Add Transaction</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 30px;">
                        <div class="card-header" style="background: linear-gradient(135deg, #17a2b8 0%, #1f9faf 100%);">Filter Transactions</div>
                        <div class="card-body">
                            <form id="filterForm" class="banking-form-grid">
                                <div class="form-group">
                                    <label for="filterStartDate" class="form-label">Start Date</label>
                                    <input type="date" id="filterStartDate" class="form-input banking-date-input">
                                </div>
                                <div class="form-group">
                                    <label for="filterEndDate" class="form-label">End Date</label>
                                    <input type="date" id="filterEndDate" class="form-input banking-date-input">
                                </div>
                                <div class="form-group">
                                    <label for="filterDescription" class="form-label">Description</label>
                                    <input type="text" id="filterDescription" class="form-input" placeholder="Search text...">
                                </div>
                                <div class="form-group">
                                    <label for="filterStatus" class="form-label">Status</label>
                                    <select id="filterStatus" class="form-input banking-status-select">
                                        <option value="all">All</option>
                                        <option value="reconciled">Reconciled</option>
                                        <option value="uncleared">Uncleared</option>
                                    </select>
                                </div>
                            </form>
                             <div style="text-align: center; margin-top: -20px;">
                                <button type="button" class="btn btn-secondary" id="clearFiltersBtn">Clear Filters</button>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 30px;">
                         <div class="card-header" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">Import CSV</div>
                         <div class="card-body">
                            <p style="margin-bottom: 20px;">Import transactions from your bank's CSV export. Supports multiple formats with automatic detection.</p>
                            <div class="form-group">
                                <label class="form-label">Select CSV File</label>
                                <input type="file" id="csvFileInput" class="form-input" accept=".csv">
                            </div>
                            <div style="text-align: center; margin-top: 15px;">
                                <button class="btn btn-primary" id="importCsvSyncBtn">Sync Only (No Reconcile)</button>
                                <button class="btn btn-success" id="importCsvReconcileBtn">Import & Auto-Reconcile</button>
                            </div>
                            <div class="alert alert-info" style="margin-top: 15px;">
                                <strong>Sync Only:</strong> Adds new transactions only if they don't already exist (fuzzy match: ±2 days, ±$1).<br>
                                <strong>Auto-Reconcile:</strong> Adds new transactions AND marks matched transactions as reconciled.
                            </div>
                         </div>
                    </div>

                    <div class="card" style="margin-top: 30px;">
                         <div class="card-header" style="background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%); color: #212529;">Register Actions</div>
                         <div class="card-body" style="text-align: center;">
                            <p style="margin-bottom: 20px;">Export the currently filtered transactions to a CSV file or permanently delete old, reconciled transactions.</p>
                             <div style="display: flex; justify-content: center; gap: 15px;">
                                <button class="btn btn-success" id="exportCsvBtn">Export to CSV</button>
                                <button class="btn btn-danger" id="openPurgeModalBtn">Purge Transactions...</button>
                            </div>
                         </div>
                    </div>

                    <div style="overflow-x: auto; margin-top: 30px;">
                        <table class="report-table" id="bankRegisterTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Debit</th>
                                    <th>Credit</th>
                                    <th>Balance</th>
                                    <th>Reconciled</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bankRegisterBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jsPDF Library for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script type="module" src="js/main.js"></script>

    <script>
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>

    <div id="insufficientFundsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>&#9888; Insufficient Funds Alert</h3>
                <button id="closeModalBtn" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p>After processing this payroll, the bank register balance is now <strong id="modalBalance" style="color: #dc3545;">$0.00</strong>.</p>
                <p>Please ensure sufficient funds are available before the payday to avoid issues.</p>
            </div>
        </div>
    </div>

    <div id="purgeTransactionsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>&#9888; Purge Old Transactions</h3>
                <button id="closePurgeModalBtn" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p>This action will permanently delete all **reconciled** transactions on or before the selected date. This cannot be undone.</p>
                <div class="form-group" style="margin-top: 20px;">
                    <label for="purgeCutoffDate" class="form-label">Delete all reconciled items on or before:</label>
                    <input type="date" id="purgeCutoffDate" class="form-input" required>
                </div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                 <button type="button" class="btn btn-secondary" id="cancelPurgeBtn">Cancel</button>
                 <button type="button" class="btn btn-danger" id="confirmPurgeBtn">Confirm Purge</button>
            </div>
        </div>
    </div>
	
</body>
</html>